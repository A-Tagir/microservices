# Домашнее задание к занятию «Микросервисы: принципы»

Вы работаете в крупной компании, которая строит систему на основе микросервисной архитектуры. 
Вам как DevOps-специалисту необходимо выдвинуть предложение по организации инфраструктуры для разработки и эксплуатации.

## Задание 1

Предложите решение для обеспечения реализации API Gateway. Составьте сравнительную таблицу возможностей различных программных решений. На основе таблицы сделайте выбор решения.

Решение должно соответствовать следующим требованиям:

- маршрутизация запросов к нужному сервису на основе конфигурации,
- возможность проверки аутентификационной информации в запросах,
- обеспечение терминации HTTPS.
  
Обоснуйте свой выбор.

## Решение

## Основные и чаще всего используемые API Gateway решения:

| Название       | маршрутизация | аутентификация  | терминация HTTPS | плагины | Сложность | Лицензия        | Производительность | Масштабируемость | Хостинг |
|----------------|---------------|-----------------|------------------|---------|-----------|-----------------|--------------------|------------------|---------|
| Kong           |      Да       |       Да        |       Да         |     Да  |  Средняя  | Откр/Enterprise |     Высокая        |    Высокая       | self    |
| Apache APSIX   |      Да       |       Да        |       Да         |     Да  |  Средняя  | Открытый        |     Высокая        |    Высокая       | self    |
| Tyk            |      Да       |       Да        |       Да         |     Да  |  Простой  | Открытый        |     Высокая        |    Высокая       | self    |
| KrakenD        |      Да       |       Да        |       Да         |     Да  |  Средняя  | Открытый        |    Сверхвысокая    |    Высокая       | self    |
| Apigee         |      Да       |       Да        |       Да         |     Да  |  Средняя  | Коммерч         |     Высокая        |    Высокая       | cross   |
| Amazon API GW  |      Да       |       Да        |       Да         |     Да  |  Простой  | Открытый        |     Высокая        |    Высокая       | cloud   |
| Endpoints      |      Да       |       Да        |       Да         |     Да  |  Простой  | Открытый        |     Высокая        |    Высокая       | cloud   |
| Yandex API GW  |      Да       |       Да        |       Да         |     Да  |  Простой  | Открытый        |     Высокая        |    Высокая       | cloud   |


Для принятия решения о выборе API Gateway недостаточно вводных данных.

Так, например, неизвестно, использует ли компания облачные технологии или у компании своя инфраструктура?

- В случае облачных технологий, то разумно будет выбрать API от облачного провайдера (Yandex API Gateway)
- В случае если у компании собственная инфраструктура, то выбираем между Kong, Apache APSIX и Tyk

Здесь нужно обратить внимание какие решения уже используются в компании, какие есть в штате специалисты, планируется ли писать собственные плагины или нет.

Например, из оставшихся наиболее популярное решение Kong:
 - писать плагины нужно на языке Lua
 - требует БД Posgresql 
 - Общирное активное сообщество и документация

В то время как Tyk

- проще конфигурируется
- позволяет писать плагины на Go/python/java/javascript/.net
- более производительней чем Kong
- Требует Redis

В случае собственной инфраструктуры выбираем Kong или Tyk в зависимости от дополнительных вводных данных.

## Задание 2

Составьте таблицу возможностей различных брокеров сообщений. На основе таблицы сделайте обоснованный выбор решения.

Решение должно соответствовать следующим требованиям:

поддержка кластеризации для обеспечения надёжности,
хранение сообщений на диске в процессе доставки,
высокая скорость работы,
поддержка различных форматов сообщений,
разделение прав доступа к различным потокам сообщений,
простота эксплуатации.
Обоснуйте свой выбор.

## Решение

## Основные и чаще всего используемые брокеры сообщений:

| Функции                  |  Apache Kafka |   Rabbit MQ     | SNS/SQS          |
|--------------------------|---------------|-----------------|------------------|
| облачный                 |      нет      |       нет       |       Да         |
| сложная маршрутизация    |      нет      |       Да        |       Да         |
| производительность       | сверхвысокая  |       высокая   |       высокая    |
| простая эксплуатации     |      сложная  |       средняя   |       простая    |
| поддержка разных форматов|      нет      |       Да        |       нет        |
| Кластеризация            |      Да       |       Да        |       Да         |
| Хранение на диске        |      Да       |       Да        |       нет        |

Из данной таблице мы видим, что больше всего подходит Rabbit MQ. Решающими факторами выбора стали:
- поддерживает сложную маршрутизацию
- поддерживает множество форматов сообщений
  

